<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Demo Menu + QRIS Scanner (Upgraded)</title>
<!-- jsQR CDN -->
<script src="https://unpkg.com/jsqr/dist/jsQR.js"></script>
<style>
  :root{
    --primary:#2563eb;
    --primary-2:#7c3aed;
    --text:#0f172a;
    --muted:#64748b;
    --bg:#0b1220;
    --card:#0f172a;
    --glass:rgba(255,255,255,.08);
    --border:rgba(255,255,255,.12);
    --success:#16a34a;
    --warn:#f59e0b;
    --danger:#ef4444;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
    color:#e2e8f0; background:
      radial-gradient(1200px 600px at 20% -10%, #1e293b 0%, transparent 60%),
      radial-gradient(800px 600px at 120% 10%, #1f2a44 0%, transparent 50%),
      linear-gradient(180deg, #0b1220 0%, #0b1220 100%);
  }

  /* ===== Header ===== */
  header{
    position:relative;
    padding:22px 20px 28px;
    background:
      radial-gradient(120% 120% at -10% -10%, #3b82f680 0%, transparent 40%),
      radial-gradient(120% 120% at 110% -10%, #7c3aed80 0%, transparent 38%),
      linear-gradient(90deg,#7c3aed,#3b82f6);
    border-bottom:1px solid #ffffff22;
    box-shadow:inset 0 -40px 60px #00000022;
  }
  .topbar{
    display:flex; align-items:center; justify-content:space-between; gap:16px;
  }
  .hey{opacity:.9; font-size:12px}
  .name{font-weight:800; font-size:20px}
  .menu-trigger{
    appearance:none; border:0; background:#ffffff20; color:#fff; font-size:14px;
    padding:10px 14px; border-radius:14px; cursor:pointer;
    backdrop-filter: blur(8px);
    border:1px solid #ffffff33;
    transition: transform .12s ease, background .12s ease;
  }
  .menu-trigger:hover{ transform: translateY(-1px); background:#ffffff2e; }

  /* ===== Cards ===== */
  .section{padding:14px 16px}
  .balance-card{
    background:linear-gradient(180deg,#0b1220,#0b1220) padding-box, linear-gradient(120deg,#60a5fa55,#a78bfa55,#60a5fa55) border-box;
    border:1px solid transparent;
    color:#e2e8f0; border-radius:16px; padding:16px;
    box-shadow:0 10px 30px rgba(0,0,0,.35);
  }
  .sub{ font-size:12px; color:#94a3b8 }
  .amount{ font-size:28px; font-weight:900; letter-spacing:.3px }

  /* ===== Overlay Menu (grid) ===== */
  .overlay{
    position:fixed; inset:0; display:none; z-index:50;
    padding-top:14px; background:rgba(6,10,19,.45);
    backdrop-filter: blur(12px) saturate(120%);
  }
  .overlay.active{ display:block; animation: fade .18s ease }
  @keyframes fade{ from{opacity:0} to{opacity:1} }
  .overlay-panel{
    background:rgba(15,23,42,.85);
    backdrop-filter: blur(10px);
    border:1px solid var(--border);
    border-radius:18px; max-width:720px; margin:0 auto;
    box-shadow:0 20px 60px rgba(0,0,0,.5);
  }
  .overlay-header{
    display:flex; align-items:center; justify-content:space-between;
    padding:14px 16px; border-bottom:1px solid var(--border);
  }
  .overlay-title{ font-weight:800; font-size:18px; letter-spacing:.2px }
  .close-btn{
    appearance:none; border:0; background:var(--glass); width:38px; height:38px; border-radius:12px;
    cursor:pointer; font-size:18px; display:grid; place-items:center; color:#fff;
    border:1px solid var(--border);
  }
  .menu-grid{
    padding:16px; display:grid; grid-template-columns:repeat(3, 1fr); gap:12px;
    max-width:720px; margin:0 auto;
  }
  .menu-card{
    background:linear-gradient(180deg,#0b1220,#0b1220) padding-box, linear-gradient(145deg,#60a5fa33,#a78bfa33) border-box;
    border:1px solid transparent; border-radius:16px; padding:12px;
    display:flex; flex-direction:column; align-items:center; gap:10px; text-align:center;
    box-shadow:0 6px 18px rgba(0,0,0,.25); cursor:pointer;
    transition:transform .14s ease, box-shadow .14s ease, border-color .14s ease;
  }
  .menu-card:hover{ transform:translateY(-2px); box-shadow:0 12px 26px rgba(0,0,0,.35); border-color:#60a5fa77; }
  .icon-wrap{
    width:46px; height:46px; border-radius:14px; display:grid; place-items:center;
    background:linear-gradient(145deg,#60a5fa22,#a78bfa22);
    border:1px solid var(--border);
  }
  .menu-text{ font-size:12px; line-height:1.2; color:#cbd5e1 }

  /* ===== Scanner ===== */
  .scanner{
    position:fixed; inset:0; background:#000; color:#fff; display:none; z-index:60;
    display:flex; flex-direction:column;
  }
  .scanner.active{ display:flex; }
  .scanner-bar{
    display:flex; align-items:center; justify-content:space-between; padding:10px 12px; background:rgba(0,0,0,.35);
    backdrop-filter: blur(6px);
  }
  .scanner-title{ font-weight:700; letter-spacing:.3px; display:flex; align-items:center; gap:8px }
  .scanner-actions{ display:flex; gap:8px; }
  .btn{
    appearance:none; border:0; border-radius:12px; padding:10px 14px; cursor:pointer; font-weight:700;
    background:#ffffff15; color:#fff; border:1px solid #ffffff33;
  }
  .btn:hover{ background:#ffffff25 }
  .btn-primary{ background:var(--primary); border-color:transparent; }
  .btn-warning{ background:#f59e0b; border-color:transparent; }
  .btn-danger{ background:#ef4444; border-color:transparent; }

  .preview{ position:relative; flex:1; display:grid; place-items:center; overflow:hidden; }
  video{ width:100%; height:100%; object-fit:cover; filter: saturate(110%); }

  /* Guide frame */
  .scan-frame{
    position:absolute; width:min(76vw, 380px); aspect-ratio:1/1; border-radius:18px;
    box-shadow:
      0 0 0 999px rgba(0,0,0,.45) inset,
      0 0 0 2px rgba(255,255,255,.8);
  }
  /* moving scan line */
  .scan-line{
    position:absolute; left:50%; transform:translateX(-50%);
    width:calc(min(76vw, 380px) - 18px); height:2px; border-radius:2px;
    background: linear-gradient(90deg, transparent 0%, #ef4444 40%, #fff 50%, #ef4444 60%, transparent 100%);
    box-shadow: 0 0 12px #ef4444aa, 0 0 20px #ef4444aa;
    animation: sweep 2.2s ease-in-out infinite;
  }
  @keyframes sweep{
    0%{ top: calc(50% - 45%); opacity:.15 }
    50%{ top: 50%; opacity:.9 }
    100%{ top: calc(50% + 45%); opacity:.15 }
  }

  .scanner-footer{
    padding:12px; background:linear-gradient(180deg, transparent, rgba(0,0,0,.5));
    display:grid; gap:10px;
  }
  .fallback{
    display:flex; gap:8px; align-items:center; justify-content:center; flex-wrap:wrap;
  }
  .hint{ font-size:12px; color:#cbd5e1; text-align:center; opacity:.85 }

  /* ===== Toast hasil ===== */
  .toast{
    position:fixed; left:50%; bottom:16px; transform:translateX(-50%);
    max-width:min(92vw,720px);
    background:#0b1220; border:1px solid #334155; color:#e2e8f0;
    padding:12px 14px; border-radius:14px; z-index:80;
    display:none; box-shadow:0 14px 40px rgba(0,0,0,.45);
  }
  .toast.show{ display:grid; gap:8px; animation:fade .18s ease }
  .toast .title{ font-weight:800; font-size:14px }
  .toast .content{ font-size:13px; color:#cbd5e1; word-wrap:anywhere }
  .toast .row{ display:flex; gap:8px; flex-wrap:wrap }

  /* Small helpers */
  .badge{
    font-size:11px; padding:4px 8px; border-radius:999px; border:1px solid #ffffff33; background:#ffffff12
  }
  .row{ display:flex; align-items:center; justify-content:space-between; gap:10px }
  .copy{ cursor:pointer; opacity:.9 }
</style>
</head>
<body>

  <!-- ===== Layout 1 ===== -->
  <header>
    <div class="topbar">
      <div>
        <div class="hey">Selamat Datang</div>
        <div class="name">dapa</div>
      </div>
      <button id="openMenu" class="menu-trigger">Buka Menu</button>
    </div>

    <div class="section">
      <div class="balance-card">
        <div class="row">
          <div>
            <div class="sub">Saldo DANA</div>
            <div class="amount">Rp <span id="balance">130.500</span></div>
            <div class="sub" style="margin-top:6px;">Termasuk saldo DANA akun demo Rp1.000.000</div>
          </div>
          <div class="badge">Demo</div>
        </div>
      </div>
    </div>
  </header>

  <!-- ===== Overlay Menu ===== -->
  <div id="menuOverlay" class="overlay" aria-hidden="true">
    <div class="overlay-panel">
      <div class="overlay-header">
        <div class="overlay-title">Menu</div>
        <button class="close-btn" id="closeMenu" aria-label="Tutup">âœ•</button>
      </div>

      <div class="menu-grid">
        <div class="menu-card" data-action="pulsa">
          <div class="icon-wrap">
            <svg width="22" height="22" viewBox="0 0 24 24" fill="#60a5fa" aria-hidden="true"><path d="M3 18h2v3H3v-3Zm4-5h2v8H7v-8Zm4-6h2v14h-2V7Zm4-5h2v19h-2V2Zm4 9h2v4h-2v-4Z"/></svg>
          </div><div class="menu-text">Pulsa/Data</div>
        </div>

        <div class="menu-card" data-action="listrik">
          <div class="icon-wrap">
            <svg width="22" height="22" viewBox="0 0 24 24" fill="#facc15" aria-hidden="true"><path d="M11 21v-7H7l6-11v7h4l-6 11z"/></svg>
          </div><div class="menu-text">Listrik</div>
        </div>

        <div class="menu-card" id="openScanner">
          <div class="icon-wrap">
            <svg width="22" height="22" viewBox="0 0 24 24" fill="#22c55e" aria-hidden="true"><path d="M3 3h8v8H3V3Zm2 2v4h4V5H5Zm6 6h4v2h-4v-2Zm6 0h4v4h-4v-4Zm0 6h2v4h-2v-4Zm-6 0h4v2h-4v-2ZM3 13h2v8H3v-8Zm6 4h2v4H9v-4Zm10 4h2v2h-2v-2Z"/></svg>
          </div><div class="menu-text">QRIS Scanner</div>
        </div>

        <div class="menu-card" data-action="topup">
          <div class="icon-wrap"><svg width="22" height="22" viewBox="0 0 24 24" fill="#60a5fa"><path d="M11 5h2v6h6v2h-6v6h-2v-6H5v-2h6z"/></svg></div>
          <div class="menu-text">Top Up</div>
        </div>

        <div class="menu-card" data-action="tarik">
          <div class="icon-wrap"><svg width="22" height="22" viewBox="0 0 24 24" fill="#38bdf8"><path d="M12 3v12.17l4.59-4.58L18 12l-6 6-6-6 1.41-1.41L11 15.17V3h1z"/></svg></div>
          <div class="menu-text">Tarik Uang</div>
        </div>

        <div class="menu-card" data-action="voucher">
          <div class="icon-wrap"><svg width="22" height="22" viewBox="0 0 24 24" fill="#a78bfa"><path d="M2 10h4a2 2 0 1 0 0-4h12a2 2 0 1 0 0 4h4v4h-4a2 2 0 1 0 0 4H6a2 2 0 1 0 0-4H2v-4z"/></svg></div>
          <div class="menu-text">Voucher</div>
        </div>

        <div class="menu-card"><div class="icon-wrap"><svg width="22" height="22" viewBox="0 0 24 24" fill="#60a5fa"><circle cx="12" cy="12" r="10"/></svg></div><div class="menu-text">Game</div></div>
        <div class="menu-card"><div class="icon-wrap"><svg width="22" height="22" viewBox="0 0 24 24" fill="#60a5fa"><rect x="4" y="4" width="16" height="16" rx="3"/></svg></div><div class="menu-text">Tagihan</div></div>
        <div class="menu-card"><div class="icon-wrap"><svg width="22" height="22" viewBox="0 0 24 24" fill="#60a5fa"><path d="M3 6h18v2H3V6zm0 5h18v2H3v-2zm0 5h12v2H3v-2z"/></svg></div><div class="menu-text">Lainnya</div></div>
      </div>
    </div>
  </div>

  <!-- ===== Scanner ===== -->
  <div id="scanner" class="scanner" aria-hidden="true">
    <div class="scanner-bar">
      <div class="scanner-title">
        <!-- small qr icon -->
        <svg width="18" height="18" viewBox="0 0 24 24" fill="#fff" aria-hidden="true"><path d="M3 3h8v8H3V3Zm2 2v4h4V5H5Zm6 6h4v2h-4v-2Zm6 0h4v4h-4v-4Zm0 6h2v4h-2v-4Zm-6 0h4v2h-4v-2ZM3 13h2v8H3v-8Zm6 4h2v4H9v-4Zm10 4h2v2h-2v-2Z"/></svg>
        QRIS Scanner
      </div>
      <div class="scanner-actions">
        <button id="torchBtn" class="btn" title="Nyalakan Flash">Flash</button>
        <button id="switchCam" class="btn">Ganti Kamera</button>
        <button id="closeScanner" class="btn btn-danger">Tutup</button>
      </div>
    </div>
    <div class="preview">
      <video id="video" playsinline muted></video>
      <div class="scan-frame" aria-hidden="true"></div>
      <div class="scan-line" aria-hidden="true"></div>
    </div>
    <div class="scanner-footer">
      <div class="fallback">
        <input id="fileInput" type="file" accept="image/*" capture="environment" class="btn" />
        <button id="pasteBtn" class="btn">Tempel dari Clipboard</button>
        <button id="pauseBtn" class="btn">Pause</button>
        <button id="resumeBtn" class="btn btn-primary">Resume</button>
      </div>
      <div id="scanMsg" class="hint">Jika preview tidak muncul, pastikan membuka lewat <b>HTTPS</b> / <b>localhost</b> dan izinkan kamera.</div>
    </div>
  </div>

  <!-- ===== Toast hasil ===== -->
  <div id="toast" class="toast" role="status" aria-live="polite" aria-atomic="true">
    <div class="title" id="toastTitle">Hasil Scan</div>
    <div class="content" id="toastText">â€”</div>
    <div class="row">
      <button id="copyBtn" class="btn">Salin</button>
      <a id="openLink" class="btn btn-primary" href="#" target="_blank" rel="noopener noreferrer">Buka Link</a>
      <span id="qrisBadge" class="badge" style="display:none;">Terdeteksi QRIS</span>
    </div>
  </div>

<script>
  // ====== Elements
  const menuOverlay = document.getElementById('menuOverlay');
  const openMenuBtn  = document.getElementById('openMenu');
  const closeMenuBtn = document.getElementById('closeMenu');

  const scanner      = document.getElementById('scanner');
  const openScannerCard = document.getElementById('openScanner');
  const closeScannerBtn = document.getElementById('closeScanner');

  const video = document.getElementById('video');
  const msg   = document.getElementById('scanMsg');
  const switchCamBtn = document.getElementById('switchCam');
  const torchBtn     = document.getElementById('torchBtn');
  const fileInput = document.getElementById('fileInput');
  const pasteBtn = document.getElementById('pasteBtn');
  const pauseBtn = document.getElementById('pauseBtn');
  const resumeBtn = document.getElementById('resumeBtn');

  const toast = document.getElementById('toast');
  const toastTitle = document.getElementById('toastTitle');
  const toastText  = document.getElementById('toastText');
  const copyBtn    = document.getElementById('copyBtn');
  const openLink   = document.getElementById('openLink');
  const qrisBadge  = document.getElementById('qrisBadge');

  // ====== State
  let currentStream = null;
  let useBackCamera = true;
  let paused = false;
  let rafId = null;
  let imageCapture = null; // for torch
  const canvas = document.createElement('canvas');
  const ctx = canvas.getContext('2d', { willReadFrequently: true });

  // ====== Utils
  const isSecureOK = () => (window.isSecureContext || location.protocol === 'https:' || location.hostname === 'localhost');

  const showToast = (title, text, isQRIS=false) => {
    toastTitle.textContent = title;
    toastText.textContent = text;
    qrisBadge.style.display = isQRIS ? 'inline-block' : 'none';

    // guess URL to enable "Buka Link"
    try{
      const maybeUrl = text.match(/https?:\/\/[^\s]+/i)?.[0];
      if(maybeUrl){
        openLink.style.display = 'inline-block';
        openLink.href = maybeUrl;
      }else{
        openLink.style.display = 'none';
        openLink.removeAttribute('href');
      }
    }catch{ openLink.style.display='none'; }

    toast.classList.add('show');

    // feedback
    if('vibrate' in navigator) navigator.vibrate(40);
    try{
      const ctx = new (window.AudioContext||window.webkitAudioContext)();
      const o = ctx.createOscillator(); const g = ctx.createGain();
      o.frequency.value = 880; g.gain.value = 0.03; o.connect(g); g.connect(ctx.destination);
      o.start(); setTimeout(()=>{o.stop(); ctx.close();}, 130);
    }catch{}
  };

  const hideToast = () => toast.classList.remove('show');

  const stopCamera = () => {
    if(currentStream){
      currentStream.getTracks().forEach(t => t.stop());
      currentStream = null;
      video.srcObject = null;
      imageCapture = null;
    }
    if(rafId) cancelAnimationFrame(rafId);
    rafId = null;
  };

  async function startCamera(){
    try{
      if(!isSecureOK()){
        throw new Error('Browser mengharuskan HTTPS agar kamera aktif. Buka halaman ini via HTTPS.');
      }
      stopCamera();

      // Try environment camera; fallback gracefully if exact fails
      let constraints = {
        audio:false,
        video:{ facingMode: useBackCamera ? { exact:"environment" } : "user" }
      };
      try{
        currentStream = await navigator.mediaDevices.getUserMedia(constraints);
      }catch{
        constraints = { audio:false, video:{ facingMode: useBackCamera ? "environment" : "user" } };
        currentStream = await navigator.mediaDevices.getUserMedia(constraints);
      }

      video.srcObject = currentStream;
      await video.play();
      msg.textContent = 'Arahkan kamera ke QRâ€¦';

      // prepare torch control if supported
      const track = currentStream.getVideoTracks()[0];
      imageCapture = ('ImageCapture' in window) ? new ImageCapture(track) : null;
      const capabilities = track.getCapabilities ? track.getCapabilities() : {};
      if(capabilities.torch){
        torchBtn.disabled = false;
        torchBtn.dataset.enabled = 'false';
      }else{
        torchBtn.disabled = true;
      }

      paused = false;
      scanLoop();
    }catch(err){
      console.error(err);
      msg.textContent = err.message.includes('HTTPS')
        ? 'Kamera butuh HTTPS. Upload ke hosting HTTPS (mis. GitHub Pages) atau buka via localhost.'
        : (err.name === 'NotAllowedError' ? 'Akses kamera ditolak. Izinkan kamera lalu coba lagi.' : 'Tidak bisa akses kamera. Coba ganti kamera atau unggah foto QR.');
    }
  }

  function scanLoop(){
    if(paused || !video.videoWidth){ rafId = requestAnimationFrame(scanLoop); return; }

    // Resize canvas to video frame (fit square center for better speed)
    const vw = video.videoWidth, vh = video.videoHeight;
    const size = Math.min(vw, vh);
    const sx = (vw - size)/2, sy = (vh - size)/2;

    canvas.width = size; canvas.height = size;
    ctx.drawImage(video, sx, sy, size, size, 0, 0, size, size);
    const img = ctx.getImageData(0,0,size,size);

    const result = jsQR(img.data, img.width, img.height, { inversionAttempts:'attemptBoth' });

    if(result && result.data){
      const text = result.data.trim();
      const isQRIS = detectQRIS(text);
      showToast('Hasil Scan', text, isQRIS);
      // auto-pause sejenak supaya tidak spam
      paused = true;
    }

    rafId = requestAnimationFrame(scanLoop);
  }

  function detectQRIS(payload){
    // Deteksi ringan: QRIS menggunakan EMVCo, biasanya diawali "000201..." dan mengandung tag 26/51 (merchant account info).
    // Ini bukan validator penuh, hanya heuristik cepat.
    if(!payload) return false;
    const p = payload.trim();
    if(!/^(\d{2}\d{2})+/.test(p)) return false; // harus pattern tag+len
    if(!p.startsWith('000201')) return false;
    return /26\d{2}/.test(p) || /51\d{2}/.test(p);
  }

  // ===== Menu events
  openMenuBtn.addEventListener('click', () => menuOverlay.classList.add('active'));
  closeMenuBtn.addEventListener('click', () => menuOverlay.classList.remove('active'));

  // ===== Open/close scanner
  openScannerCard.addEventListener('click', async () => {
    menuOverlay.classList.remove('active');
    scanner.classList.add('active');
    hideToast();
    await startCamera();
  });

  closeScannerBtn.addEventListener('click', () => {
    stopCamera();
    scanner.classList.remove('active');
    hideToast();
  });

  // ===== Switch camera
  switchCamBtn.addEventListener('click', async () => {
    useBackCamera = !useBackCamera;
    await startCamera();
  });

  // ===== Torch toggle
  torchBtn.addEventListener('click', async () => {
    try{
      if(!currentStream) return;
      const track = currentStream.getVideoTracks()[0];
      const capabilities = track.getCapabilities ? track.getCapabilities() : {};
      if(!capabilities.torch) { msg.textContent = 'Perangkat ini tidak mendukung flash.'; return; }
      const curr = torchBtn.dataset.enabled === 'true';
      await track.applyConstraints({ advanced:[{ torch: !curr }]});
      torchBtn.dataset.enabled = (!curr).toString();
      torchBtn.textContent = !curr ? 'Flash ON' : 'Flash';
    }catch(e){ console.warn(e); msg.textContent = 'Gagal mengubah flash.'; }
  });

  // ===== Pause / Resume
  pauseBtn.addEventListener('click', () => { paused = true; msg.textContent='Paused. Tekan Resume untuk lanjut.'; });
  resumeBtn.addEventListener('click', () => { paused = false; msg.textContent='Arahkan kamera ke QRâ€¦'; });

  // ===== Decode from file
  fileInput.addEventListener('change', async () => {
    if(fileInput.files?.length){
      const imgBlob = fileInput.files[0];
      const imgEl = new Image();
      imgEl.onload = () => {
        const w = imgEl.naturalWidth, h = imgEl.naturalHeight;
        canvas.width = w; canvas.height = h;
        ctx.drawImage(imgEl, 0, 0, w, h);
        const data = ctx.getImageData(0,0,w,h);
        const result = jsQR(data.data, data.width, data.height, { inversionAttempts:'attemptBoth' });
        if(result && result.data){
          const text = result.data.trim();
          const isQRIS = detectQRIS(text);
          showToast('Hasil dari Gambar', text, isQRIS);
        }else{
          showToast('Tidak Terdeteksi', 'QR tidak ditemukan pada gambar yang diunggah.', false);
        }
      };
      imgEl.onerror = () => showToast('Gagal Membaca', 'Tidak dapat memuat gambar yang dipilih.', false);
      imgEl.src = URL.createObjectURL(imgBlob);
    }
  });

  // ===== Paste from clipboard (image)
  pasteBtn.addEventListener('click', async () => {
    try{
      const items = await navigator.clipboard.read();
      for(const item of items){
        const type = item.types.find(t => t.startsWith('image/'));
        if(type){
          const blob = await item.getType(type);
          const img = new Image();
          img.onload = () => {
            canvas.width = img.naturalWidth; canvas.height = img.naturalHeight;
            ctx.drawImage(img,0,0,canvas.width,canvas.height);
            const data = ctx.getImageData(0,0,canvas.width,canvas.height);
            const result = jsQR(data.data, data.width, data.height, { inversionAttempts:'attemptBoth' });
            if(result && result.data){
              const text = result.data.trim();
              const isQRIS = detectQRIS(text);
              showToast('Hasil dari Clipboard', text, isQRIS);
            }else{
              showToast('Tidak Terdeteksi', 'QR tidak ditemukan pada gambar yang ditempel.', false);
            }
          };
          img.src = URL.createObjectURL(blob);
          return;
        }
      }
      showToast('Clipboard Kosong', 'Tidak ada gambar di clipboard.', false);
    }catch(e){
      showToast('Tidak Didukung', 'Browser tidak mengizinkan akses clipboard gambar.', false);
    }
  });

  // ===== Toast actions
  copyBtn.addEventListener('click', async () => {
    try{
      await navigator.clipboard.writeText(toastText.textContent || '');
      copyBtn.textContent = 'Tersalin âœ“';
      setTimeout(()=> copyBtn.textContent='Salin', 1200);
    }catch{ /* ignore */ }
  });

  // Auto-hide toast on click outside
  toast.addEventListener('click', (e) => {
    if(e.target === toast) hideToast();
  });

  // Close toast on ESC
  window.addEventListener('keydown', (e)=>{
    if(e.key === 'Escape') hideToast();
  });

  // Stop camera when tab hidden (hemat baterai)
  document.addEventListener('visibilitychange', () => {
    if(document.hidden){ stopCamera(); }
  });
</script>
</body>
</html>
